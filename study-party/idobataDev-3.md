# 井戸端dev OS　vol.3

## 実装

### RUST

curgo：Rust公式の ビルドシステム兼パッケージマネージャ。pipとviteのあわせみたいなもんか

### `asm!("pause")`とは？

主に **スピン待ち（busy-wait）ループ**で CPU に「いま回り続けて待ってるだけだよ」と伝える *ヒント命令*。

効果としてはだいたいこんな感じ：

- スピンループの **消費電力・発熱を下げやすい**
- Hyper-Threading 環境で **同じコア上の相方スレッドを邪魔しにくい**
- ループが空回りして **パイプラインに悪影響**を出すのを減らす

なぜ何度も言うの？CPUは覚えていらない？

 ⇒ 「一度言えばCPUが“待機モード”を覚えてくれる」タイプの命令じゃない

### デバック用関数を書く

Rustにもprint関数はあるけど、OSがないと使えないため、OS開発の時は自前で書く必要がある

### PWS

※これはあくまでもOSの本の話

- p = pFlag
- w = write
- S＝Supervisor（つまりOS）

## 寄り道勉強トピック

## シリアルポートポートってなに？

そもそも、ポートとはコンピュータが外部とやりとりするための **“入出力の窓口”** のこと。

例：USBポート（USB機器と通信）、LANポート（ネットワーク）、HDMI（映像）、そして **シリアルポート**（文字やデータを順番に送る通信）

※ここで言う「ポート」は“物理的な口”の意味。ネットワークの「TCP 80番ポート」みたいな“番号”とは別物だよ。

### 「シリアル」と「パラレル」の違い

■パラレル（並列）

- **複数本の線**で、同時に何ビットも送る
- 昔のプリンタ端子とかで見たやつ

■シリアル（直列）

- **少ない本数の線**で、1ビットずつ順番に送る
- これが **シリアルポート**

今は高速化や配線の都合で、シリアル系が主流。

## ページング

物理アドレスから仮想アドレスに変換するために使う。

1段目の変換：rustとOSで数値の小さいほうを書く順番が違うため逆にする

ページングの「N-level」は、**仮想アドレス→物理アドレス変換で、何段の表（ページテーブル）をたどるか**の話で、CPU/モードによって段数が違う。

Huge Page：これのおかげでL1テーブルを飛ばせる。ポインタの指すメモリが広いイメージ
低レイヤーでは、アドレスとして扱う際には上位4bitはアドレスとして使って、下位4bitはどうせゼロだからフラグにしちゃう

GDT：16Bに4Bたして20Bにして、権限設定をする。今はアドレス変換は使われずに権限だけを使われている。TSSに関する説明（権限、大きさ、アドレスなど）が書いてある

TSS：IDTを内包する

IDT：Interrupt Descriptor Table（割り込みディスクリプタテーブル）。割り込みの理由とその場合に実行する関数の対応表。ISTの何番目を使うのかが書いてある

IST：スタックテーブル

## UEFIとは？

UEFIはファームウェアの仕様。「ハードウェアを動かすために機器の中に入ってる基本ソフト」だよ。OSより“下”にいて、電源を入れた直後から動く。

x86はCPUの仕様